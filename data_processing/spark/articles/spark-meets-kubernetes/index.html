<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-data_processing docs-doc-id-spark/articles/spark-meets-kubernetes" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Spark meets Kubernetes: the complete guide | Sharek.dev</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://helkaroui.github.io/data_processing/spark/articles/spark-meets-kubernetes"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="tech, big data, spark, GitOps"><meta data-rh="true" name="author" content="Hamza EL KAROUI"><meta data-rh="true" name="twitter:site" content="@stringly_typed"><meta data-rh="true" name="twitter:creator" content="@stringly_typed"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-data_processing-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-data_processing-current"><meta data-rh="true" property="og:title" content="Spark meets Kubernetes: the complete guide | Sharek.dev"><meta data-rh="true" name="description" content="This article is still in review üöß by the co-authors."><meta data-rh="true" property="og:description" content="This article is still in review üöß by the co-authors."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://helkaroui.github.io/data_processing/spark/articles/spark-meets-kubernetes"><link data-rh="true" rel="alternate" href="https://helkaroui.github.io/data_processing/spark/articles/spark-meets-kubernetes" hreflang="en"><link data-rh="true" rel="alternate" href="https://helkaroui.github.io/data_processing/spark/articles/spark-meets-kubernetes" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Sharek.dev RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Sharek.dev Atom Feed"><link rel="stylesheet" href="/assets/css/styles.00b7d67d.css">
<link rel="preload" href="/assets/js/runtime~main.0e186504.js" as="script">
<link rel="preload" href="/assets/js/main.414c1a00.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">‚≠êÔ∏è If you like Sharek.dev, give it a star on <a href="https://github.com/helkaroui/helkaroui.github.io">GitHub</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Sharek" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Sharek" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Sharek.dev</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Data Processing</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/data_processing/spark">Apache Spark</a></li><li><a class="dropdown__link" href="/data_processing/kafka/">Apache Kafka</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Containers</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/containers/docker/quick_start">Docker</a></li><li><a class="dropdown__link" href="/containers/kubernetes/quick_start">Kubernetes</a></li><li><a class="dropdown__link" href="/containers/podman/quick_start">Podman</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Developer&#x27;s Corner</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/developer/languages/scala/quick_start">Scala</a></li><li><a class="dropdown__link" href="/developer/languages/python/quick_start">Python</a></li><li><a class="dropdown__link" href="/developer/languages/go/quick_start">Go</a></li><li><a class="dropdown__link" href="/developer/languages/rust/quick_start">Rust</a></li><li><a class="dropdown__link" href="/developer/languages/java/quick_start">Java</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Home Lab</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/home_lab">My Home Lab</a></li><li><a class="dropdown__link" href="/home_lab/media_center/funkwhale">FunkWhale</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Projects</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/projects/scheduler">Scheduler</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/about">About</a><a href="https://github.com/helkaroui" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/data_processing/spark/">Apache Spark</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data_processing/spark/">Quick Start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/data_processing/spark/tutorials/getting-started-with-spark">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/data_processing/spark/optimizations/quick_wins">Optimizations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/data_processing/spark/internals/index">Spark Internals</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/data_processing/spark/customization/create-plugin">Customizations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/data_processing/spark/articles/databricks-spark-developer-associate-exam">Other articles</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/data_processing/spark/articles/databricks-spark-developer-associate-exam">Databricks Certified Associate Developer for Apache Spark Exam questions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/data_processing/spark/articles/spark-meets-go">Spark meets Go Lang</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/data_processing/spark/articles/spark-meets-kubernetes">Spark meets Kubernetes: the complete guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/data_processing/spark/articles/whats-new-in-spark3">Exploring the Exciting New Features in Apache Spark 3.0</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/data_processing/kafka/">Kafka</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/data_processing/flink/">Flink</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Apache Spark</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Other articles</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Spark meets Kubernetes: the complete guide</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Spark meets Kubernetes: the complete guide</h1></header><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/about"><img class="avatar__photo" src="https://images.weserv.nl/?url=avatars.githubusercontent.com/u/22795356?s=96&amp;v=4&amp;fit=cover&amp;mask=circle&amp;maxage=7d" alt="Hamza EL KAROUI" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url" href="/about"><span itemprop="name">Hamza EL KAROUI</span></a></div><small class="avatar__subtitle" itemprop="description">Freelance, Senior Data Engineer / DevOps</small></div></div><br><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p>This article is still in review üöß by the co-authors.</p></div></div><p><img loading="lazy" src="/assets/images/spark-on-k8s-41426f75a2dc0b543430a8d6c2fdcc15.png" width="1650" height="1060" class="img_ev3q"></p><p>In today&#x27;s data-driven world, the ability to efficiently process and analyze large datasets is crucial. Apache Spark has been a go-to solution for big data processing, while Kubernetes has emerged as a leading platform for container orchestration. Together, these two technologies form a potent combination, offering a scalable and flexible environment for managing and executing Spark workloads.</p><p>In this context, we want to share our take aways from migrating old Spark Standalone clusters to kubernetes using Spark Submit.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="project-context">Project context<a href="#project-context" class="hash-link" aria-label="Direct link to Project context" title="Direct link to Project context">‚Äã</a></h2><p>The client&#x27;s infrastructure is build on top of OpenStack, thus most of services are installed manually or using Ansible, on top of virtual machines. With these constraints, the big data team has build multiple Spark Standalone clusters for each of their environments.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="goals--constraints">Goals &amp; Constraints<a href="#goals--constraints" class="hash-link" aria-label="Direct link to Goals &amp; Constraints" title="Direct link to Goals &amp; Constraints">‚Äã</a></h3><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p><strong>Dynamic Scaling</strong>
Dynamic scaling refers to the ability to automatically adjust the number of Spark executors in response to workload demands. This feature allows applications to efficiently utilize cluster resources while maintaining optimal performance.</p><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">Learn more ...</summary><div><div class="collapsibleContent_i85q"><ol><li><p><strong>Initial Deployment</strong>:
When you submit a Spark application to run on Kubernetes, you define an initial number of executor pods based on your workload requirements and resource availability. These executor pods run alongside the Spark driver pod.</p></li><li><p><strong>Monitoring Metrics</strong>:
Kubernetes, along with monitoring tools like Prometheus and Grafana, collects metrics about the Spark application&#x27;s resource usage, such as CPU and memory consumption, as well as the progress of tasks within the application.</p></li><li><p><strong>Resource Utilization Thresholds</strong>:
You can configure resource utilization thresholds or policies that define when the cluster should scale up or down based on predefined criteria. These thresholds are often defined in terms of CPU and memory utilization.</p></li><li><p><strong>Scaling Trigger</strong>:
When the metrics collected breach the predefined thresholds, Kubernetes triggers the scaling process. If resource utilization is consistently high and exceeds the defined threshold, Kubernetes initiates the scaling up process to allocate more resources to the Spark application.</p></li><li><p><strong>Scaling Up</strong>:</p></li></ol><ul><li>Kubernetes increases the desired number of Spark executor pods by creating new pods.</li><li>These new executor pods join the existing Spark driver pod and executor pods to distribute the workload.</li><li>The Spark application can take advantage of the additional resources to process data faster.</li></ul><ol start="6"><li><p><strong>Continued Monitoring</strong>:
Kubernetes and monitoring tools continue to monitor the Spark application&#x27;s resource usage. If resource utilization drops below a certain threshold or the workload decreases, Kubernetes may trigger a scaling down process to reduce the number of executor pods.</p></li><li><p><strong>Scaling Down</strong>:</p></li></ol><ul><li>Kubernetes gracefully terminates the selected executor pods.</li><li>Spark gracefully handles the termination of these executor pods, ensuring that in-progress tasks are not lost and that data is not corrupted.</li><li>Once the executor pods have been safely terminated, the Spark application continues to run with the remaining resources.</li></ul><ol start="8"><li><strong>Iterative Process</strong>:
Dynamic scaling is an iterative process that can occur multiple times during the execution of a Spark application. It allows the application to adapt to changing resource demands, ensuring efficient resource utilization without manual intervention.</li></ol></div></div></details></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="architecture">Architecture<a href="#architecture" class="hash-link" aria-label="Direct link to Architecture" title="Direct link to Architecture">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="spark-submit-architecture">Spark-Submit Architecture<a href="#spark-submit-architecture" class="hash-link" aria-label="Direct link to Spark-Submit Architecture" title="Direct link to Spark-Submit Architecture">‚Äã</a></h4><p>Spark Submit can be used to submit a Spark Application directly to a Kubernetes cluster. The flow would be as follows:</p><p><img loading="lazy" src="/assets/images/spark-submit-process-3ee98a82c76d0a6591085a837ff3b8fa.svg" width="1866" height="862" class="img_ev3q"></p><ol><li>The client, that lives outside or inside the kubernetes cluster, submit an application and asks the k8s API to create the driver</li><li>k8s creates Spark driver running within a Kubernetes pod.</li><li>The driver requests k8s to create executors which are also running within Kubernetes pods.</li><li>k8s creates the executors </li><li>The driver is notified and connects to them.</li><li>The driver executes application code on executors.</li></ol><p>When the application completes, the executor pods terminate and are cleaned up, but the driver pod persists logs and remains in ‚Äúcompleted‚Äù state in the Kubernetes API until it‚Äôs eventually garbage collected or manually cleaned up.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Note that in the completed state, the driver pod does not use any computational or memory resources.</p></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>There is another approche to schedule spark application on kubernetes, which by using a <code>Spark Operator</code>. The operator should be installed into kubernetes cluster.</p><p>Each has its own advantages and use cases, and the choice between them depends on your specific requirements and infrastructure setup.</p><ul><li><p>Use spark-submit when:</p><ul><li>You need maximum flexibility and control over Spark configurations.</li><li>You are already comfortable with the spark-submit command.</li><li>Your Spark applications need to run in various cluster environments.</li></ul></li><li><p>Use Spark Operator when:</p><ul><li>You want a Kubernetes-native, automated solution.</li><li>You prefer to define and manage Spark applications as Kubernetes resources.</li><li>You need dynamic scaling and resource management features.</li><li>You are using Kubernetes extensively in your infrastructure.</li></ul></li></ul></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="project-architecture">Project Architecture<a href="#project-architecture" class="hash-link" aria-label="Direct link to Project Architecture" title="Direct link to Project Architecture">‚Äã</a></h4><p>In this project, we will showcase two ways to schedule Spark applications on kubernetes:</p><ul><li>Native Kubernetes solution: using kubernetes Job resource type to submit the application.</li><li>Scheduler: using Airflow to schedule application.</li></ul><p>For these two solutions we propose the following architectures :</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Using Kubernetes jobs</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Using a scheduler: Airflow</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div style="padding:20px;background-color:#f6f8fa"><p><em>What is a kubernetes Job ?</em></p><blockquote><p>A Job creates one or more Pods and will continue to retry execution of the Pods until a specified number of them successfully terminate. As pods successfully complete, the Job tracks the successful completions. </p><p>‚Äî kubernetes.io</p></blockquote><p>For more details about jobs, check the <a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/" target="_blank" rel="noopener noreferrer">kubernetes docs</a>.</p><p><img loading="lazy" src="/assets/images/spark-submit-on-k8s--using-jobs-3d715dcdd60391673bc0833f0f00d77d.svg" width="2122" height="1602" class="img_ev3q"></p></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div style="padding:20px;background-color:#f6f8fa"><p><em>What is a kubernetes Job ?</em></p><blockquote><p>Apache Airflow‚Ñ¢ is an open-source platform for developing, scheduling, and monitoring batch-oriented workflows. Airflow‚Äôs extensible Python framework enables you to build workflows connecting with virtually any technology.</p><p>‚Äî airflow.apache.org</p></blockquote><p>For more details about Airflow, check the <a href="https://airflow.apache.org/" target="_blank" rel="noopener noreferrer">officiel website</a>.</p><p><img loading="lazy" src="/assets/images/spark-submit-on-k8s--using-airflow-43841e8802d08d5ee628ca6383ebd326.svg" width="2122" height="1602" class="img_ev3q"></p></div></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-started">Getting Started<a href="#getting-started" class="hash-link" aria-label="Direct link to Getting Started" title="Direct link to Getting Started">‚Äã</a></h2><p>I recommand you to download the project source code from my Github Repo <span style="background-color:rgb(168, 255, 236);border-radius:8px;color:#fff;padding:0.2rem;border:1px solid var(--ifm-alert-border-color)"> <a href="https://github.com/helkaroui/spark-on-k8s" target="_blank" rel="noopener noreferrer">helkaroui/spark-on-k8s</a> </span>  , and try to follow the following steps. It will help you to understand the different sections by stadying the code.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a href="#requirements" class="hash-link" aria-label="Direct link to Requirements" title="Direct link to Requirements">‚Äã</a></h3><p>In this project we will need to setup the following tools :</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="container--infrastructure">Container &amp; Infrastructure<a href="#container--infrastructure" class="hash-link" aria-label="Direct link to Container &amp; Infrastructure" title="Direct link to Container &amp; Infrastructure">‚Äã</a></h4><ul><li><a href="https://docs.docker.com/engine/install/" target="_blank" rel="noopener noreferrer"><strong>Docker</strong></a></li></ul><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">How to install Docker ?</summary><div><div class="collapsibleContent_i85q"><p>Set up Docker&#x27;s Apt repository:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt-get</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> ca-certificates </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> gnupg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -m 0755 -d /etc/apt/keyrings</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -fsSL https://download.docker.com/linux/ubuntu/gpg </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> gpg --dearmor -o /etc/apt/keyrings/docker.gpg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain"> a+r /etc/apt/keyrings/docker.gpg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;deb [arch=&quot;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">dpkg --print-architecture</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">)</span><span class="token string" style="color:rgb(255, 121, 198)">&quot; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    &quot;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$(</span><span class="token variable builtin class-name" style="color:rgb(189, 147, 249);font-style:italic">.</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> /etc/os-release </span><span class="token variable operator" style="color:rgb(189, 147, 249);font-style:italic">&amp;&amp;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable builtin class-name" style="color:rgb(189, 147, 249);font-style:italic">echo</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable string" style="color:rgb(255, 121, 198);font-style:italic">&quot;</span><span class="token variable string variable" style="color:rgb(189, 147, 249);font-style:italic">$VERSION_CODENAME</span><span class="token variable string" style="color:rgb(255, 121, 198);font-style:italic">&quot;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">)</span><span class="token string" style="color:rgb(255, 121, 198)">&quot; stable&quot;</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">tee</span><span class="token plain"> /etc/apt/sources.list.d/docker.list </span><span class="token operator">&gt;</span><span class="token plain"> /dev/null</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt-get</span><span class="token plain"> update</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To install the latest version, run:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now add your user to the Docker group:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">usermod</span><span class="token plain"> -aG </span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> </span><span class="token environment constant" style="color:rgb(189, 147, 249)">$USER</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> newgrp </span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the Docker Engine installation is successful by running the hello-world image.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> run hello-world</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><ul><li><a href="https://minikube.sigs.k8s.io/docs/start/" target="_blank" rel="noopener noreferrer"><strong>Minikube</strong></a> is local Kubernetes, focusing on making it easy to learn and develop for Kubernetes.kube</li></ul><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">How to install Minikube ?</summary><div><div class="collapsibleContent_i85q"><p>To install the latest version, run:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> minikube-linux-amd64 /usr/local/bin/minikube </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">rm</span><span class="token plain"> minikube-linux-amd64</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the Minikube installation is successful by starting it:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">minikube start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can check the available node by running:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">minikube kubectl get nodes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And you can access the Dashboard with this command, the Dashboard will be launched at <a href="http://localhost:41169" target="_blank" rel="noopener noreferrer">localhost:41169</a></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">minikube dashboard</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><ul><li><a href="https://kubernetes.io/fr/docs/tasks/tools/install-kubectl/" target="_blank" rel="noopener noreferrer"><strong>kubectl</strong></a> is a command line tool used to run commands against Kubernetes clusters.</li></ul><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">How to install Kubectl ?</summary><div><div class="collapsibleContent_i85q"><p>For kubectl, we can either install it, or create an alias to <code>minikube kubectl</code>.</p><p><em>Method 1</em>: Install kubectl</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -LO </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://dl.k8s.io/release/</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$(</span><span class="token string variable function" style="color:rgb(80, 250, 123);font-style:italic">curl</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic"> -L -s https://dl.k8s.io/release/stable.txt</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">)</span><span class="token string" style="color:rgb(255, 121, 198)">/bin/linux/amd64/kubectl&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -o root -g root -m 0755 kubectl /usr/local/bin/kubectl </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">rm</span><span class="token plain"> kubectl</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>Method 2:</em> For simplicity, we will add an alias to our .bashrc file and apply it:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">vim</span><span class="token plain"> ~/.bashrc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Add this line at the end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">alias</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">kubectl</span><span class="token operator">=</span><span class="token plain">minikube kubectl</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Save and apply the file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> ~/.bashrc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><h4 class="anchor anchorWithStickyNavbar_LWe7" id="dev-tools">Dev tools<a href="#dev-tools" class="hash-link" aria-label="Direct link to Dev tools" title="Direct link to Dev tools">‚Äã</a></h4><ul><li><a href="https://kustomize.io/" target="_blank" rel="noopener noreferrer"><strong>Kustomize</strong></a> is a Kubernetes configuration transformation tool that allows you to customize untemplated YAML files, leaving the original files intact.</li></ul><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">How to install Kustomize ?</summary><div><div class="collapsibleContent_i85q"><p>To install :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -s </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh&quot;</span><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">bash</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> kustomize /usr/local/bin/ </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">rm</span><span class="token plain"> kustomize</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify setup:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kustomize version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><ul><li><a href="https://skaffold.dev/" target="_blank" rel="noopener noreferrer"><strong>Skaffold</strong></a> is a command line tool that facilitates continuous development for container based &amp; Kubernetes applications.</li></ul><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">How to install Skaffold ?</summary><div><div class="collapsibleContent_i85q"><p>To install :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -Lo skaffold https://storage.googleapis.com/skaffold/releases/v2.0.4/skaffold-linux-amd64 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain"> +x skaffold </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">mv</span><span class="token plain"> skaffold /usr/local/bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify setup:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">skaffold version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Skaffold handles the workflow for building, pushing and deploying your application. It is similar to <code>Docker-compose</code> for kubernetes.
This enables you to focus on iterating on your application locally while Skaffold continuously deploys to your local or remote Kubernetes cluster, local Docker environment or Cloud Run project.</p><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">How it works in short ?</summary><div><div class="collapsibleContent_i85q"><p><img loading="lazy" src="/assets/images/skaffold-architecture-04ec12ff6f7ea3c159df0acd2f8b7cda.png" width="8305" height="4309" class="img_ev3q"></p></div></div></details><p>Follow this <a href="https://skaffold.dev/docs/quickstart/" target="_blank" rel="noopener noreferrer">officiel tutorial</a> if you‚Äôre using to Skaffold. It walks through running Skaffold on a small Kubernetes app built with Docker inside minikube and deployed with kubectl.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-project-structure">The project structure<a href="#the-project-structure" class="hash-link" aria-label="Direct link to The project structure" title="Direct link to The project structure">‚Äã</a></h3><p>We will start by creating a project with a structure that emphasis the separation of rules, i.e. we seperate the code base, the service component and the environment specifics on which the application will run. This concept is also called <code>Environment-Agnostic Design</code> also known as <code>environment-agnostic architecture</code> or <code>platform-agnostic design</code>.</p><p>In that sperit, here is our project structure :</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îú‚îÄ‚îÄ images</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ   ‚îú‚îÄ‚îÄ base-images</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ spark-base-image</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ   ‚îî‚îÄ‚îÄ custom-images</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ       ‚îî‚îÄ‚îÄ spark-app-example</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îú‚îÄ‚îÄ services</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ   ‚îú‚îÄ‚îÄ sparkhs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ   ‚îú‚îÄ‚îÄ spark-submit-job</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ   ‚îî‚îÄ‚îÄ spark-reverse-proxy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îî‚îÄ‚îÄ deployment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ‚îú‚îÄ‚îÄ base</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ‚îî‚îÄ‚îÄ overlays</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ‚îú‚îÄ‚îÄ dev</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ‚îî‚îÄ‚îÄ prod</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p><strong>images :</strong> The docker images folder is where lives our code base, it can also be split into two folders :</p><ul><li><em>base-images</em> for base docker that will be used to build other images. Example : spark, jdk, python, sbt, gradle.</li><li><em>custom-images</em> which can enhirit from base images, and holds images with our code base.</li></ul></li><li><p><strong>services :</strong> Here we define the services that will run our docker images on kubernetes.</p></li><li><p><strong>Deployment :</strong> this folder holds resources and variants of environment configurations - like <code>development</code>, <code>staging</code> and <code>production</code> - using overlays that modify a common base.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="building-docker-images">Building docker images<a href="#building-docker-images" class="hash-link" aria-label="Direct link to Building docker images" title="Direct link to Building docker images">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="spark-base-image">Spark Base Image<a href="#spark-base-image" class="hash-link" aria-label="Direct link to Spark Base Image" title="Direct link to Spark Base Image">‚Äã</a></h4><p>We decided to create a custom spark docker image rather than using the provided docker image, in order to showcase the possibility of customizing Spark upon the project needs.</p><p>The easiest way is to mimic the Dockerfile located in Spark <a href="https://github.com/apache/spark/blob/master/resource-managers/kubernetes/docker/src/main/dockerfiles/spark/Dockerfile" target="_blank" rel="noopener noreferrer">Repository</a></p><p>We reduce the dockerfile to it&#x27;s minimum and we add a stage to build spark from source using maven.</p><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">images/base-images/spark-base-image/Dockerfile</summary><div><div class="collapsibleContent_i85q"><div><div class="language-docker codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-docker codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></details><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>At this point, we can test everything by building the docker image <code>docker build .</code> The build will take couple of minutes, since we are compiling the source code. </p><p>We can of course replace this section, and download the binaries from <a href="https://spark.apache.org" target="_blank" rel="noopener noreferrer">https://spark.apache.org</a>, to reduce the build time. But the aim here is to be able to easily customize Spark, add libraries and adapt it to our needs.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="spark-app-example-image">Spark App Example Image<a href="#spark-app-example-image" class="hash-link" aria-label="Direct link to Spark App Example Image" title="Direct link to Spark App Example Image">‚Äã</a></h4><p>To showcase a fully working spark application, we create a basic Scala/Spark application with two scripts :</p><ul><li><em>Compute Pi</em> this script will compute an approximation to PI and log the result. The code is also included in <a href="https://github.com/apache/spark/blob/master/examples/src/main/scala/org/apache/spark/examples/SparkPi.scala" target="_blank" rel="noopener noreferrer">Spark-Examples</a> module.</li><li><em>Streaming Example</em> A basic streaming script with Spark structured streaming.</li></ul><p>We first start by creating an SBT project as follow :</p><p>1- <code>cd</code> to the folder <code>images/custom-images/</code>.</p><p>2- Run the following command <code>sbt new scala/scala3.g8</code>. This pulls the ‚Äòscala3‚Äô template from GitHub. It will also create a target folder, which you can ignore.</p><p>3- When prompted, name the application <code>spark-app-example</code>. This will create a project called ‚Äúspark-app-example‚Äù.</p><p>4- Let‚Äôs take a look at what just got generated:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îú‚îÄ‚îÄ build.sbt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îú‚îÄ‚îÄ project</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ¬†¬† ‚îî‚îÄ‚îÄ build.properties</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îú‚îÄ‚îÄ README.md</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îî‚îÄ‚îÄ src</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ‚îú‚îÄ‚îÄ main</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ scala</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ Main.scala</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ‚îî‚îÄ‚îÄ test</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ‚îî‚îÄ‚îÄ scala</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ‚îî‚îÄ‚îÄ MySuite.scala</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>5- Adding a dependency in the <code>build.sbt</code> file :</p><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">images/custom-images/spark-app-example/build.sbt</summary><div><div class="collapsibleContent_i85q"><div><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></details><p>6- Add <code>sbt-assembly</code> plugin under <code>project/plugins.sbt</code> :</p><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">images/custom-images/spark-app-example/project/plugins.sbt</summary><div><div class="collapsibleContent_i85q"><div><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></details><p>7- Create the scala script <code>SparkPi</code> under package <code>dev.sharek.examples</code> :</p><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">images/custom-images/spark-app-example/src/main/scala/dev/sharek/examples/SparkPi.scala</summary><div><div class="collapsibleContent_i85q"><div><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></details><p>8- Finaly, we add the Dockerfile that builds the sbt project into jar files:</p><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">images/custom-images/spark-app-example/Dockerfile</summary><div><div class="collapsibleContent_i85q"><div><div class="language-docker codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-docker codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></details><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>At this point, we can test everything by building the docker image <code>docker build .</code></p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1st-approach-kubernetes-job">1st approach: Kubernetes Job<a href="#1st-approach-kubernetes-job" class="hash-link" aria-label="Direct link to 1st approach: Kubernetes Job" title="Direct link to 1st approach: Kubernetes Job">‚Äã</a></h3><p>To be able to mimic a real big data architecture, we want to have a distribute storage layer for the spark application to store it&#x27;s Dataframes.
We choosed S3, as it is widely used in big data projects.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="s3-service">S3 Service<a href="#s3-service" class="hash-link" aria-label="Direct link to S3 Service" title="Direct link to S3 Service">‚Äã</a></h4><p>The docker file:</p><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">services/s3/Dockerfile</summary><div><div class="collapsibleContent_i85q"><div><div class="language-docker codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-docker codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></details><h4 class="anchor anchorWithStickyNavbar_LWe7" id="spark-submit-service">Spark Submit Service<a href="#spark-submit-service" class="hash-link" aria-label="Direct link to Spark Submit Service" title="Direct link to Spark Submit Service">‚Äã</a></h4><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">services/spark-submit-job/Dockerfile</summary><div><div class="collapsibleContent_i85q"><div><div class="language-docker codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-docker codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></details><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">services/spark-submit-job/entrypoint.sh</summary><div><div class="collapsibleContent_i85q"><div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></details><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">services/spark-submit-job/job.yaml</summary><div><div class="collapsibleContent_i85q"><div><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></details><h4 class="anchor anchorWithStickyNavbar_LWe7" id="deploying-the-spark-pi-demo-application">Deploying the Spark Pi Demo Application<a href="#deploying-the-spark-pi-demo-application" class="hash-link" aria-label="Direct link to Deploying the Spark Pi Demo Application" title="Direct link to Deploying the Spark Pi Demo Application">‚Äã</a></h4><p>starting Minikube:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">minikube start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl get nodes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">Makefile</summary><div><div class="collapsibleContent_i85q"><div><div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></details><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">make</span><span class="token plain"> spark-submit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="checking-the-logs">Checking the logs<a href="#checking-the-logs" class="hash-link" aria-label="Direct link to Checking the logs" title="Direct link to Checking the logs">‚Äã</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl get pods</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl logs driver-ccccccc-</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="accessing-the-spark-ui">Accessing the Spark UI<a href="#accessing-the-spark-ui" class="hash-link" aria-label="Direct link to Accessing the Spark UI" title="Direct link to Accessing the Spark UI">‚Äã</a></h4><p>The UI associated with any application can be accessed locally using kubectl port-forward.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl port-forward </span><span class="token operator">&lt;</span><span class="token plain">driver-pod-name</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number">4040</span><span class="token plain">:4040</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then, the Spark driver UI can be accessed on <a href="http://localhost:4040" target="_blank" rel="noopener noreferrer">http://localhost:4040</a>.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Checking logs ....</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="adding-the-reverse-proxy">Adding the Reverse Proxy<a href="#adding-the-reverse-proxy" class="hash-link" aria-label="Direct link to Adding the Reverse Proxy" title="Direct link to Adding the Reverse Proxy">‚Äã</a></h4><details class="details_lb9f alert alert--info details_r1OI" data-collapsed="true"><summary mdxtype="summary">services/spark-reverse-proxy/Dockerfile</summary><div><div class="collapsibleContent_i85q"><div><div class="language-docker codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-docker codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></details><h4 class="anchor anchorWithStickyNavbar_LWe7" id="adding-spark-history-server">Adding Spark History Server<a href="#adding-spark-history-server" class="hash-link" aria-label="Direct link to Adding Spark History Server" title="Direct link to Adding Spark History Server">‚Äã</a></h4><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2nd-approach-airflow-scheduler">2nd approach: Airflow Scheduler<a href="#2nd-approach-airflow-scheduler" class="hash-link" aria-label="Direct link to 2nd approach: Airflow Scheduler" title="Direct link to 2nd approach: Airflow Scheduler">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="creating-an-airflow-service">Creating an Airflow Service<a href="#creating-an-airflow-service" class="hash-link" aria-label="Direct link to Creating an Airflow Service" title="Direct link to Creating an Airflow Service">‚Äã</a></h4><h4 class="anchor anchorWithStickyNavbar_LWe7" id="deploying-the-spark-pi-demo-application-1">Deploying the Spark Pi Demo Application<a href="#deploying-the-spark-pi-demo-application-1" class="hash-link" aria-label="Direct link to Deploying the Spark Pi Demo Application" title="Direct link to Deploying the Spark Pi Demo Application">‚Äã</a></h4><h4 class="anchor anchorWithStickyNavbar_LWe7" id="checking-the-logs-1">Checking the logs<a href="#checking-the-logs-1" class="hash-link" aria-label="Direct link to Checking the logs" title="Direct link to Checking the logs">‚Äã</a></h4><p>TBD</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">‚Äã</a></h2><p>TBD</p><p><strong>Resources:</strong></p><ul><li><a href="https://skaffold.dev/" target="_blank" rel="noopener noreferrer">https://skaffold.dev/</a></li><li><a href="https://blog.cellenza.com/en/data/using-spark-with-kubernetes-k8s/" target="_blank" rel="noopener noreferrer">https://blog.cellenza.com/en/data/using-spark-with-kubernetes-k8s/</a></li><li><a href="https://devopscube.com/kustomize-tutorial/" target="_blank" rel="noopener noreferrer">https://devopscube.com/kustomize-tutorial/</a></li><li><a href="https://xebia.com/blog/using-scala-3-with-spark/" target="_blank" rel="noopener noreferrer">Using Scala 3 with Spark</a></li><li>Install Minikube: <a href="https://minikube.sigs.k8s.io/docs/start/" target="_blank" rel="noopener noreferrer">https://minikube.sigs.k8s.io/docs/start/</a></li><li>Install kubectl <a href="https://kubernetes.io/docs/tasks/tools/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/tasks/tools/</a></li><li>Setup Airflow on k8s : <a href="https://www.bhavaniravi.com/apache-airflow/deploying-airflow-on-kubernetes" target="_blank" rel="noopener noreferrer">https://www.bhavaniravi.com/apache-airflow/deploying-airflow-on-kubernetes</a></li><li>Airflow Dag: <a href="https://www.projectpro.io/recipes/use-sparksubmitoperator-airflow-dag" target="_blank" rel="noopener noreferrer">https://www.projectpro.io/recipes/use-sparksubmitoperator-airflow-dag</a></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/data_processing/spark/articles/spark-meets-go"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Spark meets Go Lang</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/data_processing/spark/articles/whats-new-in-spark3"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Exploring the Exciting New Features in Apache Spark 3.0</div></a></nav><div style="margin-top:3em"></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#project-context" class="table-of-contents__link toc-highlight">Project context</a><ul><li><a href="#goals--constraints" class="table-of-contents__link toc-highlight">Goals &amp; Constraints</a></li><li><a href="#architecture" class="table-of-contents__link toc-highlight">Architecture</a><ul><li><a href="#spark-submit-architecture" class="table-of-contents__link toc-highlight">Spark-Submit Architecture</a></li><li><a href="#project-architecture" class="table-of-contents__link toc-highlight">Project Architecture</a></li></ul></li></ul></li><li><a href="#getting-started" class="table-of-contents__link toc-highlight">Getting Started</a><ul><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a><ul><li><a href="#container--infrastructure" class="table-of-contents__link toc-highlight">Container &amp; Infrastructure</a></li><li><a href="#dev-tools" class="table-of-contents__link toc-highlight">Dev tools</a></li></ul></li><li><a href="#the-project-structure" class="table-of-contents__link toc-highlight">The project structure</a></li><li><a href="#building-docker-images" class="table-of-contents__link toc-highlight">Building docker images</a><ul><li><a href="#spark-base-image" class="table-of-contents__link toc-highlight">Spark Base Image</a></li><li><a href="#spark-app-example-image" class="table-of-contents__link toc-highlight">Spark App Example Image</a></li></ul></li><li><a href="#1st-approach-kubernetes-job" class="table-of-contents__link toc-highlight">1st approach: Kubernetes Job</a><ul><li><a href="#s3-service" class="table-of-contents__link toc-highlight">S3 Service</a></li><li><a href="#spark-submit-service" class="table-of-contents__link toc-highlight">Spark Submit Service</a></li><li><a href="#deploying-the-spark-pi-demo-application" class="table-of-contents__link toc-highlight">Deploying the Spark Pi Demo Application</a></li><li><a href="#checking-the-logs" class="table-of-contents__link toc-highlight">Checking the logs</a></li><li><a href="#accessing-the-spark-ui" class="table-of-contents__link toc-highlight">Accessing the Spark UI</a></li><li><a href="#adding-the-reverse-proxy" class="table-of-contents__link toc-highlight">Adding the Reverse Proxy</a></li><li><a href="#adding-spark-history-server" class="table-of-contents__link toc-highlight">Adding Spark History Server</a></li></ul></li><li><a href="#2nd-approach-airflow-scheduler" class="table-of-contents__link toc-highlight">2nd approach: Airflow Scheduler</a><ul><li><a href="#creating-an-airflow-service" class="table-of-contents__link toc-highlight">Creating an Airflow Service</a></li><li><a href="#deploying-the-spark-pi-demo-application-1" class="table-of-contents__link toc-highlight">Deploying the Spark Pi Demo Application</a></li><li><a href="#checking-the-logs-1" class="table-of-contents__link toc-highlight">Checking the logs</a></li></ul></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Recent articles</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/data_processing/spark/articles/spark-meets-kubernetes">Spark on k8s: the complete guide</a></li><li class="footer__item"><a class="footer__link-item" href="/data_processing/spark/articles/spark-meets-go">Spark meets Go!</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/helkaroui" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2024 Sharek.dev, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0e186504.js"></script>
<script src="/assets/js/main.414c1a00.js"></script>
</body>
</html>