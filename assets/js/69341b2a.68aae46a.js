"use strict";(self.webpackChunksharek_dev=self.webpackChunksharek_dev||[]).push([[1744],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>d});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),p=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},m=function(e){var t=p(e.components);return a.createElement(i.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),c=p(n),d=r,k=c["".concat(i,".").concat(d)]||c[d]||u[d]||o;return n?a.createElement(k,s(s({ref:t},m),{},{components:n})):a.createElement(k,s({ref:t},m))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=c;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:r,s[1]=l;for(var p=2;p<o;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},7717:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const o={title:"Storage"},s=void 0,l={unversionedId:"kubernetes/storage",id:"kubernetes/storage",title:"Storage",description:"Volumes",source:"@site/sections/containers/kubernetes/storage.md",sourceDirName:"kubernetes",slug:"/kubernetes/storage",permalink:"/containers/kubernetes/storage",draft:!1,tags:[],version:"current",frontMatter:{title:"Storage"},sidebar:"docs",previous:{title:"Quick start",permalink:"/containers/kubernetes/quick_start"},next:{title:"Node Affinity",permalink:"/containers/kubernetes/node_affinity"}},i={},p=[{value:"Volumes",id:"volumes",level:2},{value:"Background",id:"background",level:3},{value:"Volume Types",id:"volume-types",level:3},{value:"Ephemeral: emptyDir",id:"ephemeral-emptydir",level:4},{value:"Persistant: local",id:"persistant-local",level:4}],m={toc:p};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"volumes"},"Volumes"),(0,r.kt)("p",null,"In k8s pods are ephemeral which means on-disk files will be lost when container crashes. The kubelet restarts the container with a clean state.\nThe second important point is file sharing between pods."),(0,r.kt)("p",null,"K8s solves both of these problems with it's volume abstraction."),(0,r.kt)("h3",{id:"background"},"Background"),(0,r.kt)("p",null,"k8s supports many types of volumes and a pod can use any number of volume types simultaneously. Volume types can be :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Ephemeral volume types: have a lifetime of the pod and k8s destroys it when the pod ceases to exist."),(0,r.kt)("li",{parentName:"ul"},"Persistant volume types: it's preserved across container restarts.")),(0,r.kt)("h3",{id:"volume-types"},"Volume Types"),(0,r.kt)("p",null,"Here are some examples of volume types, please refer to k8s ",(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/storage/volumes/#volume-types"},"documentation")," for the full list."),(0,r.kt)("h4",{id:"ephemeral-emptydir"},"Ephemeral: emptyDir"),(0,r.kt)("p",null,"An ",(0,r.kt)("inlineCode",{parentName:"p"},"emptyDir")," volume is first created when a Pod is assigned to a node, and exists as long as that Pod is running on that node. When created the volume is initially empty."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Use cases :")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"scratch space"),(0,r.kt)("li",{parentName:"ul"},"checkpointing a long computation for recovery from crashes"),(0,r.kt)("li",{parentName:"ul"},"holding files that a content-manager container fetches while a webserver container serves the data")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"emptyDir")," volumes are stored on whatever medium you chose, such as disk or SSD or network storage or memory."),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"When the ",(0,r.kt)("inlineCode",{parentName:"p"},"Memory")," medium is chosen, k8s mounts a tmpfs (RAM based filesystem) for you instead. Unlike disk, tmpfs is very fast, but it's size will be count against your container's memory limit."))),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"How to create an ",(0,r.kt)("inlineCode",{parentName:"em"},"emptyDir")," volume ?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"{14}","{14}":!0},'apiVersion: v1\nkind: Pod\nmetadata:\n  name: test-pd\nspec:\n  containers:\n  - image: k8s.gcr.io/test-webserver\n    name: test-container\n    volumeMounts:\n    - mountPath: /cache\n      name: emptydir-volume\n  volumes:\n  - name: emptydir-volume\n    emptyDir:\n      medium: "Memory"\n')),(0,r.kt)("h4",{id:"persistant-local"},"Persistant: local"),(0,r.kt)("p",null,"A ",(0,r.kt)("inlineCode",{parentName:"p"},"local")," volume represents a mounted local storage device such as a disk, partition or directory.\nLocal volumes can only be used as a statically created PersistentVolume. Dynamic provisioning is not supported."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"local")," volumes are used in a durable and portable manner without manually scheduling pods to nodes. The system is aware of the volume's node constraints by looking at the node affinity on the PersistentVolume."),(0,r.kt)("p",null,"The following example shows a ",(0,r.kt)("inlineCode",{parentName:"p"},"PersistentVolume")," using a ",(0,r.kt)("inlineCode",{parentName:"p"},"local")," volume and ",(0,r.kt)("inlineCode",{parentName:"p"},"nodeAffinity"),":\n1- Add a label to a node :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl get nodes --show-labels\n")),(0,r.kt)("p",null,"The output is similar to this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"NAME      STATUS    ROLES    AGE     VERSION        LABELS\nworker0   Ready     <none>   1d      v1.13.0        ...,kubernetes.io/hostname=worker0\nworker1   Ready     <none>   1d      v1.13.0        ...,kubernetes.io/hostname=worker1\ndata-node   Ready     <none>   1d      v1.13.0        ...,kubernetes.io/hostname=data-node\n")),(0,r.kt)("p",null,"2- Chose one of your nodes, and add a label to it:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl label nodes <your-node-name> disktype=ssd\n")),(0,r.kt)("p",null,"3- Apply your PersistentVolume :\nYou must set a PersistentVolume nodeAffinity when using local volumes. The Kubernetes scheduler uses the PersistentVolume nodeAffinity to schedule these Pods to the correct node."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: example-pv\nspec:\n  capacity:\n    storage: 100Gi\n  volumeMode: Filesystem\n  accessModes:\n  - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Delete\n  storageClassName: local-storage\n  local:\n    path: /mnt/disks/ssd1\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: disktype\n          operator: In\n          values:\n          - ssd\n")))}u.isMDXComponent=!0}}]);